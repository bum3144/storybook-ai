<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>AI ê·¸ë¦¼ë™í™” ë§Œë“¤ê¸°</title>
  <style>
    body { font-family: 'Arial', sans-serif; max-width: 800px; margin: 40px auto; line-height: 1.6; }
    input, button { padding: 8px 10px; font-size: 1em; }
    .story-box { background: #f6f6f6; padding: 16px; border-radius: 10px; margin-top: 20px; white-space: pre-wrap; }
    .btns { margin: 10px 0 16px; }
    .btns button + button { margin-left: 8px; }
    @media print {
      button, input, label { display: none !important; }
      body { margin: 10mm; font-size: 18px; line-height: 1.8; }
      .story-box { background: #fff; border: none; }
    }
  </style>
</head>
<body>
  <h1>ğŸŒ± AI ê·¸ë¦¼ë™í™” ìƒì„±ê¸° (Demo)</h1>

  <label>í‚¤ì›Œë“œ ì…ë ¥ (ì‰¼í‘œë¡œ êµ¬ë¶„):</label><br />
  <input type="text" id="keywords" placeholder="ì˜ˆ: ì”¨ì•—, ìˆ², ì¹œêµ¬" /><br /><br />

  <label>í˜ì´ì§€ ìˆ˜:</label>
  <input type="number" id="pages" value="3" min="1" max="5" /><br /><br />

  <div class="btns">
    <button onclick="generateStory()">ë™í™” ìƒì„±í•˜ê¸°</button>
    <button onclick="saveStory()">í˜„ì¬ ìŠ¤í† ë¦¬ ì €ì¥</button>
    <button onclick="window.print()">PDFë¡œ ì €ì¥</button>
  </div>

  <div id="output" class="story-box"></div>

  <script>
    async function generateStory() {
      const keywords = document.getElementById('keywords').value.split(',').map(k => k.trim());
      const pages = parseInt(document.getElementById('pages').value);
      const output = document.getElementById('output');

      output.innerText = 'â³ ìƒì„± ì¤‘...';

      const res = await fetch('/api/story', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ keywords, pages, withImages: true })
      });
      const data = await res.json();

      let html = `<div><strong>ğŸ“– ${data.title}</strong></div>`;
      html += `<div style="margin-top:10px; white-space:pre-wrap">${data.pages.join('\n\n')}</div>`;

      if (data.images && data.images.length) {
        html += `<div style="display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin-top:16px;">`;
        for (const url of data.images) {
          html += `<div><img src="${url}" alt="" style="width:100%; border-radius:10px; border:1px solid #dfe3e6" /></div>`;
        }
        html += `</div>`;
      }

      output.innerHTML = html;
      window.__lastStory = data; // ì €ì¥ìš©
    }

    async function saveStory() {
      if (!window.__lastStory) return alert('ë¨¼ì € ë™í™”ë¥¼ ìƒì„±í•˜ì„¸ìš”!');
      const res = await fetch('/api/story/save', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(window.__lastStory)
      });
      const data = await res.json();
      alert(data.saved ? ('ì €ì¥ ì™„ë£Œ!\n' + data.path) : 'ì €ì¥ ì‹¤íŒ¨');
    }
  </script>
</body>
</html>
